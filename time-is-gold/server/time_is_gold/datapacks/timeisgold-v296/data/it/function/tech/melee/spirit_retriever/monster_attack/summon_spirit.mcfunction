scoreboard players set #SPIRIT_POS_ORDER_MIN item.spirit_retriever.spirit_pos_order 2147483647

$execute as @s at @s positioned ~-1 ~1 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~1 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~ ~1 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~ ~1 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~1 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~1 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~1 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~1 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
#$execute as @s at @s positioned ~ ~1 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
#$execute as @s at @s positioned ~ ~1 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~1 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~1 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~1 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~1 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~ ~1 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~ ~1 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~1 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~1 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~2 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~2 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~ ~2 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~ ~2 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~2 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~2 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~2 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~2 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
#$execute as @s at @s positioned ~ ~2 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
#$execute as @s at @s positioned ~ ~2 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~2 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~2 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~2 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~2 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~ ~2 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~ ~2 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~2 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~2 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~3 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~3 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~ ~3 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~ ~3 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~3 ~-1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~3 ~-1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~3 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~3 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~ ~3 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~ ~3 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~3 ~ if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~3 ~ if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @s at @s positioned ~-1 ~3 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~-1 ~3 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~ ~3 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~ ~3 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646
$execute as @s at @s positioned ~1 ~3 ~1 if block ~ ~ ~ #it:air run summon marker ~ ~ ~ {Tags:["item.spirit_retriever.spirit_pos", "item.spirit_retriever.spirit_pos.$(playerid)"]}
$execute as @s at @s positioned ~1 ~3 ~1 if block ~ ~ ~ #it:air store result score @n[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid),distance=..0.5] item.spirit_retriever.spirit_pos_order run random value 0..2147483646

$execute as @e[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid)] run scoreboard players operation #SPIRIT_POS_ORDER_MIN item.spirit_retriever.spirit_pos_order < @s item.spirit_retriever.spirit_pos_order
$execute as @e[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid)] if score @s item.spirit_retriever.spirit_pos_order = #SPIRIT_POS_ORDER_MIN item.spirit_retriever.spirit_pos_order run scoreboard players set @s item.spirit_retriever.spirit_pos_order -1
$execute as @e[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid)] unless score @s item.spirit_retriever.spirit_pos_order matches -1 run kill @s
$execute as @e[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid)] at @s run summon vex ~ ~ ~ {Tags:["monster","item.spirit_retriever.spirit","item.spirit_retriever.spirit.$(targetuuid)"], Health:1, NoAI:true, NoGravity:true, attributes:[{id:"max_health",base:1}], Passengers:[{id:"minecraft:marker",Tags:["item.spirit_retriever.marker.spirit_data"],data:{playerid:$(playerid), targetuuid:"$(targetuuid)"}}]}

# SFX
$execute as @e[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid)] at @s run playsound entity.vex.charge hostile @a ~ ~ ~ 1 0.5 0

$kill @e[type=marker,tag=item.spirit_retriever.spirit_pos.$(playerid)]